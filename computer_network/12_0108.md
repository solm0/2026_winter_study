# 802.11 Wireless LAN (-> WiFi)
802.11ac - multiple input multiple output(MIMO)
하려면 안테나갯수가 많아야됨.

모두 multiple access를 위해 CSMA/CA를 쓴다.
모두 base-station, ad-hoc 네트워크 버전이 있다.

# 무선LAN의 구성요소
wireless host가 base station과 통신함.
base station은 AP (access point)이다.

그것들의 통신가능 영역이 cell(BSS, Basic Service Set)이다.
(ad hoc mode일 때는 host들의 영역)

## Channel
국가 따위가 정해놓은 2.4ghz-2.485ghz 라는 스펙트럼이 11개로 나뉜다.
AP의 관리자가 channel(주파수 대역 조각)를 정한다.
근데 다른 AP가 정한 channel이랑 주파수가 같으면 간섭 발생.

## Association
host가 새로운 AP와 맺어지기

beacon frame
- AP의 이름(SSID)
- AP의 MAC주소

Passive scanning
- AP가 주기적으로 beacon frame 전송
- host는 channel들을 바꿔가며 listen하다가 수신

Active scanning
- host가 Probe Request frame broadcast 전송
- AP가 Probe Response frame 전송

그 후 공통
- host가 선택한 AP에게 association request frame 보냄
- AP가 association response frame보냄
  (여기까진 link layer임. ip 없음 mac주소 기반)
- DHCP 실행해서 AP의 subnet의 ip주소를 받음.






# WiFi의 frame 구조
유/무선의 frame은 공통점도 있고 차이점도 있다. 무선이 좀더 복잡.

`frame control   duration   addr.1  addr.2    addr.3    seq control   addr.4    payload   CRC`

- preamble이 없음(phy layer헤더에)
- type이 없음(frame control에 포함)

- addr.1: 이번 홉에서 실제로 받는 장치 (AP, host)의 MAC
- addr.2: 이번 프레임을 실제로 송신한 장치 (AP, host)의 MAC
- addr.3: 무선 너머로 가는 AP 라우터 또는 최종목적지 쪽 MAC
- addr.4: ad hoc mode에서만 사용됨

와이파이는 누가보내는지/누가실제로받는지/AP는 누구인지 분리해야함.
받는거 - 보낸거 - 라우터(유선에연결된)

1. host가 AP(와이파이공유기?)에게 `AP주소 host주소 라우터주소`
2. AP가 라우터에게 `라우터주소 host주소` (Ethernet frame. 11일차 참고)



# WiFi의 기능들
Rate adaptation
- mobile이 움직이고 SNR(상태값)이 달라질 때 base station과 mobile의 전송 rate를 달라지게.
- mobile이 base station에서 멀리 가서 BER이 높아지면 전송률을 적게해서 BER을 낮게.






# 무선의 Multiple Access 환경
> 스토리텔링. 맥락이랑 맥락에서 나오는 키워드들 다 설명해야됨. 무선의 특징에서부터.

Multiple Access환경에서는
노드 여러개가 동시에 한 전송매체(channel)을 이용해 전송하니까
충돌이 일어나서
여러가지 나누는기능이나 나누지않고제어하는기능이있엇고 후자 중 하나가

CSMA이라고 전송 전에 sense해서
channel이 idle일때만 frame을 보내는 거였는데.

무선은 CD가 어렵다. 왜?
1. fading: signal이 점점 약해지므로 송신 중에는 남의 신호를 receive하기 어려움
2. hidden terminal: 모든 collision을 감지할 수가 없음.
3. 무선NIC 대부분 half duplex라서 보내는동안 정확한 수신 불가
(CD는 안되고 Carrier sense는 되는 이유: sense는 에너지가 있냐만 보면 되지만 detect는 신호가 깨졌는지도 판단해야해서 더 어려움)

-> 감지할 수 없으면 피해라. CSMA/CA (Collision Avoidance)

# CSMA/CA
message 기반이다.

1. sender가 channel을 sense한다(CSMA)
-> `DIFS` 동안
   - idle이면 전체 frame을 전송한다.
   - busy면 random backoff time 설정.
     1. 타이머는 channel이 idle한 동안에만 타이머를 감소시킨다. 왜 idle인 경우에만? 모든 기다리던 노드들이 idle되자마자 동시에 보내면 또 충돌할 거니까.
     2. 타이머가 다되면 전송한다.
     3. ACK이 안 오면 random backoff time을 늘려서 반복한다.
2. receiver가 frame을 받으면 `SIFS` 후 ACK 전송

SIFS는 '가능한 최소 시간'임. receiver는 가능한한 빨리 ACK를 보내고 싶겠지만 모드 전환시간,CRC,ACK생성 등 준비시간이 필요함. 모든 sender들이 'ACK은 이정도 기다려야 나온다'라는 걸 알고 있어야 함.

그래서 SIFS가 있는 거고, sender가 SIFS+ACK time 동안 기다리는 것임.
DIFS가 더 커야함. DIFS보다 길면 다른 노드가 끼어들 수 있음.





# RTS/CTS 메시지
> 이얘기도해야함. 그림 잘 보고

CSMA의 확장(옵션).
보낼 frame이 길 경우 sender가 channel을 잠시 reserve하게 함.

1. sender가 AP에게 RTS (request-to-send) 패킷 보냄
   - RTS도 충돌할 수 있지만 짧아서 괜찮.
   - RTS에는 노드정보가 들어있음
2. AP이 CTS (clear-to-send)를 broadcast함.
3. sender만 전송, 나머지는 기다림(NAV)
4. AP가 ACK -> idle.경쟁모드복귀

경쟁모드로 복귀하는 트리거 (TXOP 끝)
- sender: ACK 수신
- 다른 노드: NAV 만료

backoff time은 idle일 때 노드들끼리 눈치게임하라고 사용하는거임.

## NAV (Net Allocation Vector)
무선에서는 전송이 방송(broadcast)이다. -> RTS는 AP를 대상으로 한거지만 다른 노드들도 수신 가능하다.
RTS에는 duration 필드가 있다. duration에는 CTS+DATA+ACK 에 필요한 시간의 값이 들어있다.
그래서 RTS를 들은 노드들은 '앞으로 이만큼의 시간 동안 channel이 예약'되었음을 안다.
= NAV(RTS)

sender 근처에 있던 노드들은 보통 RTS를 듣고, AP 근처에 있던 노드들은 보통
NAV(CTS)를 사용. 그럼 CTS에도 duration이 있고 그건 DATA+ACK 시간을 포함.

이렇게 NAV이 두 가지 있는 이유는 hidden terminal problem을 최대한 커버하기 위해서다.

contention window: backoff time을 뽑는 범위. binary exponential backoff로 충돌나면 2배로 증가한다.




# 블루투스: personal area network
- 10m 지름 안
- 마우스, 키보드, 헤드폰 케이블의 대체
- ad hoc: 인프라(AP) 없음
- master/slave
  - slave가 전송 허가를 요청한다.
  - master가 요청을 승인한다.







# Mobility의 스펙트럼
mobile이 한 AP만 쓰고있음
|
mobile이 이동하면서 DHCP사용해 네트워크에 연결/연결해제됨
|
mobile이 이동하면서 connection 유지한채로 여러 AP를 거쳐감

# Mobility의 문제
> 각 부분의 명칭 기억, 방법 2개와 차이 숙지

라우팅에게 맡기기: 모바일이 어느 cell에 있든 라우터들이 그걸 라우팅 테이블에 반영하면 되지 않나?
-> 모바일 노드는 수억개, 이동할 때마다 라우터들이 업데이트하면 인터넷 터짐
-> 모바일 이동은 ms단위, 라우팅프로토콜은 초-분 단위

end-system에게 맡기기
- indirect routing: home agent거침
- direct routing: 안거침

-> 라우팅프로토콜은 그대로. 라우터들은 모바일이 이동했는지 모름. mobility정보는 home agent, mobile, foreign agent 사이에서 처리.






# Mobile IP
구성요소
- datagram의 indirect routing
- agent discovery
- home agent와의 registration

## 용어 정리
home
- home network: mobile의 영구적 'home' (개념적인...예를들어 회사 자기 사무실..)
- home agent(HA): mobile이 멀리 떨어져 있을때 mobile을 위해 mobility function(?)을 해주는. agent는 라우터에서 동작하는 소프트웨어라고한다.
- permanent address: home network에서의 주소. 어디에 있어도 이 주소로 모바일에 닿을 수 있다

foreign
- foreign agent(FA): 방문한 네트워크의 agent. 역시 mobile을 위해 mobility function을 해주는.
- care-of-address: 방문한 network가 준 임시 address
- correspondent: mobile과 소통하려는 장치

## Registration
mobile이 다른 network에 갔다.

1. FA는 Agent Advertisement를 broadcast하고있다. `COA: ...`
   - agent advertisement: agent들이 ICMP 메시지 뿌리는거
2. MA -> FA registration req
   - `COA, HA(home address), MA(mobile address) Lifetime, itentification`
3. FA -> HA registration req
   - `COA, HA, MA, Lifetime, identification, encap.format`
4. HA -> FA registration reply
   - `HA, MA, Lifetime, identification, encap.format`
   - '이 mobile은 내 network의 주민 맞다'
5. FA -> MA registration reply
   - `HA, MA, Lifetime, identification`

결과
- foreign agent는 mobile 존재를 안다
- home agent는 mobile의 위치(COA)를 안다 -> 그래서 mobile로 가는 패킷을 가로채 터널링해줄 수 있다.

### ICMP 메시지 포맷
standard ICMP
`type=9   code=0  checksum`
`router address`

mobility agent advertisement extension
`type=16  length  sequence#`
`registration   lifetime  RBHFMGV bits    reserved`
`care-of-addresses`

- H,F: agent
- R: registration required





# indirect routing
mobile이 두 주소를 사용한다.
- permanent address: 상대가 이용. 왜냐면 상대는 mobile의 위치를 모르니까
- care-of-address: home agent가 이용. home agent는 datagram을 mobile로 포워딩하려면 mobile의 위치를 알아야 하니까.

foreign agent 역할을 mobile 스스로 할 수도 있다(어떻게?)

triangle routing: 상대-home-mobile
-> 상대랑 mobile이 같은 네트워크에 있을때는 비효율(굳이 home까지 갔다오니까)

## indirect routing으로 네트워크 옮겨다니기
mobile이 다른 네트워크로 갔다
foreign agent에게 register했다.
home agent가 coa를 업데이트한다.
상대방은 mobile이 아무리 network 옮겨대도 모른다!

-> connection이 유지된다.
= 상대 입장에서 TCP/UDP 연결이 안 끊어진다. 왜냐면 ip가 바뀌지 않기 때문이다.
왜? TCP connection의 식별자는 ip, port, ip, port이다. 이게 바뀌면 연결이 끊김.
근데 permanent ip가 위치에 따라 바뀌지 않으니 연결이 끊어지지 않지.

TCP: '아무 일도 없었다'
agent들: '나너무많은일이있었어힘들다진짜'

## ip
상대가 permanent ip를 dest로 패킷 보내면 -> home agent가 그 패킷을 coa를 dest로 하는 패킷에 넣어서 보냄 -> foreign agent가 coa헤더 떼고 패킷 mobile한테 보냄






# direct routing
이전 registration은 indirect랑 같은가?
상대가 request하면 home agent가 foreign address(coa?)를 알려준다
상대가 foreign agent한테 포워드 -> foreign agent가 mobile에게 포워드
mobile이 직접 상대한테 응답.

그래서 triangle routing problem을 없앤다.
상대는 mobile이 위치 옮긴걸 알게된다. mobile이 또 network 옮기면? 또 home agent랑 registration하고 그후 상대가 foreign agent한테 요청보냈을때 mobile이 없겠지? 그럼 다시 home agent에게 coa 요청하나?

그리고 왜 상대->mobile은 foreign agent를 거치고 mobile->상대는 직접? 



## direct routing으로 망을 여러 번 옮기기
home agent가 옮겨가ㅏㄹ때마다 관리해야함 -> 몰림.
근처로 옮길테니까 처음 옮긴 foreign agent를 anchor대표로 줘서 관리를 하자

데이터는 항상 anchor foreign agent에게 처음 간다.
mobile이 움직이면 새로운 foreign agent가 이전 foreign agent에게 데이터 포워딩받아야한다. chaining

그냥 계속 anchor foreign agent랑만 하면 안되나 왜 chaining을 해야하지? chaining을 하면 옮긴 망의 갯수만큼 agent를 거쳐야 하는 거 아니야?






# Cellular network의 구성요소
wifi와 다르다.
wifi의 AP는 개인/기관이 운영하지만 셀룰러의 코어망은 통신사가 관리한다.
wifi에는 이동성이 거의 고려되지 않지만 셀룰러는 handover로 이동성이 강하다.
wifi는 관리 단위가 없고 셀룰러는 cell 단위 관리다.

# MSC (Mobile Switching Center)
cell을 만드는 BS들을 유선 네트워크에 연결시켜준다.
- '유선 네트워크'의 예시: public telephone network(telnet)

셀룰러가 mobile과 BS를 연결하는 라디오 스펙트럼?을 공유하는 두 방법
- FDMA+TDMA: 스펙트럼을 주파수로 분리한 뒤 각 channel을 time slot으로 분리한다.
- CDMA: multiple access를 code로 분리한다.

음?근데 챗지피티는
FDMA 기본, 그 안에 TDMA/CDMA/OFDMA 중 하나를 쓴다고하네.
TDMA+CDMA를 합치는 일은 없다고 한다

> 비교하기. 나오는 키워드 걍 다 외우기. 그림 외우기

## 2G(voice)
Base Station system(BSS)
- BTS(Base transceiver station)(기지국)
  - 하는일: 전파 쏘고 받기, 채널 코딩 등
  - 안테나+무선 물리계층 장비
  - BSC에 유선 연결
- BSC(Base station controller)
  - 하는일: 무선 자원 관리. BTS들을 중앙에서 제어(채널 할당/회수, 핸드오버, 전력/트래픽 관리)
  - MSC에 유선 연결

MSC (Mobile Switching center)
- 하는일: 회선교환
- Gateway MSC에 유선 연결

Gateway MSC (GMSC)
- 외부 네트워크와의 경계
- PSTN(Public Switched Telephone Network)에 유선 연결

TDMA

## 3G(voice+data)
영상스트리밍 되기 시작햇는데 잘안되는 과도기였다고 하심.
새로운 셀룰러 data네트워크가 기존 셀룰러 voice네트워크(PSTN)에 병렬적으로 작동한다.

BSS
- BTS(NodeB)
- RNC (Radio Network Controller)(BSC의 진화버전)
  - 하는일: 무선 자원 관리. 핸드오버.
  - MSC, SGSN에 유선연결. voice/data의 분기점.

MSC
- 하는일: 기존(회선교환) + SGSN과 소통(위치정보,이동성관련 신호)
- Gateway MSC에 유선연결

SGSN (Serving GPRS Support Node)
- 하는일: 패킷교환,단말인증,위치관리
- GGSN에 유선연결

GGSN (Gateway GPRS Support Node)
- 하는일: 패킷교환, 단말에 ip주소 할당. '3G데이터망의 NAT+Gateway+Router'?
- Public Internet에 유선 연결

교환(switching)이 무엇이지?
-> 들어온 트래픽을 보고 어디로 보낼지 결정, 동시에 여러 흐름을 분리/관리
- 회선교환기도, 패킷교환기도 '교환'을 할 수 있다.
- 라우터는 패킷교환기의 한 종류일 뿐이다.

구간들을 부르는 명칭
- BSS: Radio interface (WCDMA, HSPA)
- BSS-RNC: Radio access network (UTRAN)
- MSC/SGSN-GMSC/GGSN: core network (General Packet Radio Service Core Network)
- ~: public Internet
즉 mobile <-> BSS <-> BSS-RNC <-> Core Network <-> Public Network

## 4G LTE
- PSTN이 없어졌다
- RNC,SGSN,GGSN이 없어지고 새로운 컨트롤러와 Gateway들이 생겼다.

mobile <-> BSS <-> EPC (Evolved Packet Core) <-> Public Internet

모든 ip 패킷들이 core ip network(EPC?)를 통해 BS에서 Gateway로 간다.

UE (user element)
- eNodeB와 무선 연결

eNodeB (Evolved NodeB. BTS였던것)
- 하는일: 무선 data송수신
- 연결
  - MME: 무선제어 메시지 (control)
  - S-GW: 데이터

MME (Mobility Management Entity)
- 하는일: UE 인증,이동성관리,세션관리
- HSS와 연결
  - HSS (Home Subscriber Server): 가입자정보,프로필,영구id 저장

S-GW (Serving Gateway)
- 하는일: 데이터 라우팅
- P-GW에 연결: 데이터 전달

P-GW (Packet data network Gateway)
- 하는일: Public Internet에 연결, UE에게 공인ip주소 할당

왜 Gateway가 2개인가?
S-GW는 핵심 LTE 코어 내부에서 UE이동에 맞춰 라우팅(내부망관리용)
P-GW는 외부네트워크와의 게이트웨이(외부망관리용)


# 5G
초저지연, IoT



# Cellular network
셀룰러 네트워크에서 이동성을 구현하는 방법

용어 정리
- home network: 너가 구독하는 셀룰러 제공자
- HLR (Home Location Register): home network의 데이터베이스. permanent 폰번호, 프로필정보,위치정보 저장

- visited network: mobile이 현재 있는 network. 그게 home network일수도있음물론.
- VLR (visitor location register): 그 network 안에 있는 각 유저들의 entry.HLR과 같은것도있고다른것도있겠지.

# GSM
indirect routing
1. 상대의 전화가 PSTN통해 먼저 home network로 라우팅된다
2. home MSC가 HLR한다(visited network에 있는 mobile의 roaming number를 얻음)
3. home MSC가 전화를 2nd leg?세팅해서 visited Network로 데이터를보낸다?
4. visited MSC가 mobile에게 전달해준다.

## MSC를 이용한 handoff
- Hard handoff: 끊고넘어감
- Soft handoff: 연결먼저하고끊음

handoff의 목적: 새로운 base station을 통한 라우팅, 셀을 이동해도 끊김없는 서비스 제공
handoff를 하는 이유
- 더 강한 BSS의 신호
- 로드밸런스: 현재 BSS의 채널을 free up?
- GSM은 왜 handoff하는지 위임하지 않는다?(policy) 어떻게만 위임한다?먼소리

handoff는 이전 BSS에 의해 일어난다.
1. 이전 BSS가 MSC에게 handoff할거라고알리고 새로운 BSS들 리스트 전달
2. MSC가 새 BSS에 새 path 만들음(자원할당)
3. 새 BSS가 channel을 mobile을 위해 할당
4. 새 BSS가 MSC와 이전BSS에게 준비됐다고 말함
5. 이전 BSS가 mobile에게 새 BSS로 handoff하라고 말함
6. mobile과 새 BSS가 새로운 channel을 활성화하기 위해 신호
7. mobile은 새 BSS를 통해 MSC에게 신호 보냄 -> handoff 완료. MSC는 전화를 새BSS에게 라우트함
8. MSC - 이전BSS 리소스 치움

## MSC들 사이의 handoff
용어
- anchor MSC: 전화할때 처음 방문한 MSC. 전화는 계속 이 MSC로 라우팅됨.

mobile이 이동하면 새로운 MSC가 MSC 체인 끝에 추가됨






## LTE에서의 이동성 (4G)
UE가 idle 상태(현재 데이터/통화 중 아님)에서
기지국(cell) 간을 이동하면
네트워크는 UE가 어느기지국에 있는지 모름

그래서 UE를 찾기 위해 MME 가 paging message를 보냄.
이 메시지는 eNodeB(기지국)에서 broadcast됨

UE가 연결된 기지국에서 응답함

3G처럼 단계적 진행
- preparation phase: 새로운 eNodeB와 연결 준비
- Execution phase: 실제 데이터가 새로운 eNodeB로 이동
- Completion phase: 옛 eNodeB 연결 종료, 이동 완료