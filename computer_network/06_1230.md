# Network layer

- ip를 기반으로 호스트와 호스트를 연걸
- multi hop. 여러 경로를 봐서 최적의 경로를 찾는것. one-hop이 하나의 경로고.
- 전체경로중 다음노드가먼지보여주는게 링크. 네트워크는 라우팅(multi hop)관점.

> network layer의 두 가지 역할을 설명하라, 설명하고 맞추기
forwarding과 routing.을 로지컬하게 정함.링크는 피지컬하게 실어주는역할.
forwarding과 routing중 우선은 routing. 인데 그중 어디로가는지 정해주는걸 forwarding이라고함.

영역으로 나누면 data place과 control plane임. data는 forwarding, control은 routing.
- traditional routing
- softwar-defined networking. cs구조에서 서버를 둬서 controlplane을 하자. 라우터들이 알아서 하게 하지말고.(계속 도는 일 생김) 서버가 라우터정보를 다 취합해서 라우터한테 지시하는거임.

각각의 라우터마다 control plane이 있다.
SDN으로 확장하려면 라우터마다 control agent를 둬야 한다.






# Router
input ports -> fabric & processor -> ouput ports

- processor: control plane(sdn 또는 알아서)
- ports, fabric: data plane

processor는 더 잘 판단하는게 관건
fabric은 빠른속도로 보내주는게 관건

## input ports
line termination -> link layer protocol -> lookup forwarding queueing -> fabric

queueing 문제
- 인풋자체의 오버플로우
- HOL blocking: 

## high-seed switching fabric
어떻게 빠르게 아웃풋으로넘겨주나?
- memory: 느림
- bus: 같은 전기신호를 보여줘야하는데 충돌남
- crossbar: bus 쓰되 길이 여러개면 충돌 확률 줄임. 길이너무많으면 비용이 많이들음.
> 장점

## output ports
fabric -> datagram buffer queueing -> link layer protocol -> line termination

스케줄링이 필요하다. 우선순위가 부여되는 메세지가 잇음.(돈많이낸사람.재난메세지.)

FIFO: 먼저들어오면 먼저나감.
오버플로우 시: discard policy
- tail drop: 도착하는거 버림
- priority: 남겨둠
- random: 랜덤

priority: 구현방법은 여러가지.
- 높은우선순위버퍼, 낮은버퍼 classify
  - 지속적으로 우선순위 높은거 들어오면 low priority는 못보내고 ttl로 사라짐.
- Round Robin: http2.0처럼 class를 둬서 적절한 시간동안 돌리는거. low priority를 가끔씩은 체크해주게.
- Weighted Fair QueuingWFQ: 우선순위가 여러개일수도. 우선순위의 비중을 둔다. 우선순위+round robin
> 특징









# ip protocol
ip헤더 32bit.

## ip fragmentation, reassembly
MTU: link는 max transfer size가 있다. 그래서 쪼개야한다.
그래서 헤더에서 쪼갰는지 확인할정보 fragflag, offset가 필요하다.

쪼개서 안좋은점
- 유실될 확률
- 쪼개는것마다 헤더들어감 -> 메세지가생긴다는건 보내야한다는부담과 헤더라는부가정보가 가여러개생김.
- 쪼개는, 쪼갠거 합치는 처리과정도 필요함.

fragflag: 다음에 쪼개진게 오면 1, 끝났거나 안쪼개졌으면 0
offset: 연속적이라는걸알수있게 한다.

-> assemble해야한다는걸 받는쪽에서 알수잇음.

> 계산안나옴.
> mtu때문에 fragment생김 이해.

## ip주소
32bit짜리
근데 헤더도 32bit라며

디바이스만 구분함.

### 클래식한 ip체계
ip를 어떻게 달거냐
그룹단위로 묶여있다.
- 망마다 앞 세자릿수가 hostip의 network를 구분하고
- 뒤에가 host를 구분함.


네트워크(=조직)의 규모에 따라 class A,B,C로 나눔.
A는 하나의 서버는 host의 수가 많다.
B는 대기업.
C는 작은그룹. subnet

> subnet개념




# CIDR (classless interdomain routing)
class ABC세개밖에없는거말고. 유연하게.
> 개념.

destination-based forwarding
- 길이 여러개고 
- 길의 부가정보를 봐서 그게 더 맞을때 그쪽으로 보내주자


longest prefix mathcing
> 뭔지 개념
목적지주소를 봤을때 저기까지 맞으면 0에게, 여기까지 맞으면 1, 등등 매핑해주는것.
10111까지 봤을때 1,2 둘다 되면 그뒤에것도 봐서


그래서이건 ip를 붙일때 쓰는건지 ip를 보고 찾아갈때 쓰는건지....

# DHCP
동적 ip 할당.
> 과정
외부에서 클라이언트가 들어와서 접속하면 유용한 ip 하나를 설정해주는것.
그걸 위한 프로토콜이 DHCP고 할당해주기 위해서 DHCP 서버가필요함. cs구조.
DHCP서버를 찾아서 ip할당해달라고함 -> 제안 -> 오케이 -> 쓰게함.
나가면 avaliable해짐.